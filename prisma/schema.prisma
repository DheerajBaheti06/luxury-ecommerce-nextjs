// --- Prisma Schema Cheat Sheet ---
//
// ?         = Optional field (can be null).
// []        = A list of values (e.g., String[] is a list of strings).
// @id        = Primary Key (the main unique ID for a model).
// @default() = Sets a default value (e.g., cuid(), now(), false).
// @unique    = Enforces that the value in this field must be unique.
// @relation  = Defines the link between two models.
// @updatedAt = Automatically updates this timestamp on any change.
// onDelete  = Rule for what happens when a parent is deleted (e.g., Cascade).
//
// @@unique  = Composite unique: The *combination* of fields must be unique.
// @@index   = Database index: Makes queries on these fields much faster.
//
// type      = A composite type: A structured object (like Address) that is
//             embedded in a model, not a separate table.
// enum      = A set of specific allowed values (like PENDING or PAID).
//
// ---------------------------------





generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// models ----------------------------->>>>>>>
model User {
  id                  String    @id @default(cuid())
  username            String    @unique
  email               String    @unique
  password            String // Hashing and comparison happens in your code
  avatar              String?
  isAdmin             Boolean   @default(false)
  phone               String?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  refreshToken        String?
  resetPasswordToken  String?
  resetPasswordExpire DateTime?

  // Relations
  addresses Address[] // 1:Many
  orders Order[] // 1:Many
  cart Cart? // 1:1
  wishlist Wishlist? // 1:1
  reviews Review[] // 1:Many
}

// Change 'type' to 'model'
model Address {
  id        String  @id @default(cuid()) // Add a unique ID field
  street    String
  city      String
  state     String
  pinCode   String
  country   String
  // Add relation fields
  userId    String
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Add index for faster lookups by user
  @@index([userId])
}

model Category {
  id              String     @id @default(cuid())
  name            String     @unique
  description     String?
  parentCategoryId String?
  parentCategory  Category?  @relation("SubCategories", fields: [parentCategoryId], references: [id])
  subCategories   Category[] @relation("SubCategories")

  // Relations
  products Product[]  // 1:Many
}

model Brand {
  id String @id @default(cuid())
  name String @unique
  logo String?
  products Product[]
}

model Product {
  id             String    @id @default(cuid())
  title          String
  description    String
  price          Decimal   @db.Decimal(10, 2)
  discountPrice  Decimal?  @db.Decimal(10, 2)
  images         String[]
  brand          Brand?  @relation(fields: [brandId], references: [id])
  brandId        String?
  ratingsAverage Float     @default(0)
  ratingsCount   Int       @default(0)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  categoryId     String
  category       Category  @relation(fields: [categoryId], references: [id])

  // Relations
  variants      Variant[]
  cartItems     CartItem[]
  wishlistItems WishlistItem[]
  orderItems    OrderItem[]
  reviews       Review[]

  // Indexes
  @@index([brandId, price])
  @@index([categoryId, price])
}

model Variant {
  id String @id @default(cuid()) 
  color String
  size String
  stock Int
  price Decimal @db.Decimal(10, 2)
  image String?
  productId String
  products Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, color, size])
}

model Review {
  id String @id @default(cuid())
  rating Float @default(0)
  images String[]
  comment String?
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String
  user User @relation(fields:[userId], references: [id], onDelete: Cascade)
  userId String
  createdAt DateTime @default(now())

  @@index([productId])
  @@index([userId])

  @@unique([productId, userId])
}

model Cart {
  id String @id @default(cuid())
  user User @relation(fields: [userId] , references: [id], onDelete: Cascade)
  userId String @unique
  items CartItem[]
}

model CartItem {
  id String @id @default(cuid())
  quantity Int @default(1)
  price Decimal @db.Decimal(10, 2)
  cart Cart @relation(fields: [cartId], references:[id], onDelete: Cascade)
  cartId String
  product Product @relation(fields: [productId], references: [id])
  productId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([cartId, productId])
}

model Wishlist {
  id String @id @default(cuid())
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @unique
  items WishlistItem[]
}

model WishlistItem {
    id String @id @default(cuid())
    image String?
    color String
    size String
    wishlist Wishlist @relation(fields: [wishlistId], references: [id], onDelete: Cascade)
    wishlistId String
    product Product @relation(fields: [productId], references: [id])
    productId String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([wishlistId, productId])
}

model Order {
  id String @id @default(cuid())
  orderItems OrderItem[]
  user User @relation(fields: [userId], references: [id])
  userId String
  totalPrice Decimal @db.Decimal(10, 2)
  paymentStatus PaymentStatus @default(PENDING)
  deliveryStatus DeliveryStatus @default(PENDING)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model OrderItem {
  id String @id @default(cuid())
  price Decimal @db.Decimal(10, 2)
  quantity Int @default(1)
  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderId String
  product Product @relation(fields: [productId], references: [id])
  productId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}



// composite type ---------------------------->>>>>>>


enum PaymentStatus {
  PENDING
  PAID
  FAILED
}

enum DeliveryStatus {
  PENDING
  SHIPPED
  DELIVERED
  CANCELLED
}
